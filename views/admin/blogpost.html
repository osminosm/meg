<%- include('../partials/admin-header.html', pageHeader) %>

<div class="container-fluid">
  <div id="blogpostform">
    <form action="#">
      <div class="row">
        <div class="form-group col-sm-10">
          <input type="text" class="form-control" v-model="title" placeholder="Post title" />
        </div>
        <div class="form-group col-sm-2">
          <button class="btn btn-success btn-block" v-on:click="save"><i class="fa fa-save"></i> Save</button>
        </div>
      </div>

      <div class="form-group">
        <input type="text" class="form-control" v-model="slug" placeholder="Post slug" />
      </div>
      <div class="form-group">
        <div data-editable data-name="main-content" class="post-content-editor">
          <!-- Content Goes Here -->
        </div>
      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="/assets/vendor/content-tools/content-tools.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
<script>
  const editor = ContentTools.EditorApp.get()
  new Vue({
    el: '#blogpostform',
    data: {
      id: null,
      title: '',
      slug: '',
      content: '<h1>Heelo <i>World</i></h1>',
      published: false,
      dateCreated: null,
      dateModified: null
    },
    mounted() {
      editor.init('*[data-editable]', 'data-name', null, false)
      editor.start()
      const regions = editor.regions()
      const initialContent = document.createElement('div')
      initialContent.innerHTML = this.$data.content
      regions['main-content'].setContent(initialContent)

      editor.addEventListener('saved', (ev) => {
        this.$data.content = ev.detail().regions['main-content']
      })
    },
    methods: {
      save(e) {
        e.preventDefault()
        editor.save(true)
        const postData = {
          title: this.$data.title,
          slug: this.$data.slug,
          content: this.$data.content
        }
        console.log(postData)
        axios.post('/api/blog/posts', postData)
          .then((res) => {
            console.log(res)
          })
          .catch((err) => { console.log(err) })
      }
    }
  })
</script>

<%- include ../partials/footer.html %>